

{% extends 'base/base.html' %}
{% load static %}

{% block extra_style %}
  <link rel="stylesheet" href="{% static 'css/dice_date/profile.css' %}" />
  <link rel="stylesheet" href="{% static 'css/dice_date/profile_btn.css' %}" />
  <link rel="stylesheet" href="{% static 'css/dice_date/profile_avatar.css' %}" />
{% endblock %}

{% block main %}
<div class="profile-container">
    <h1>–ü—Ä–æ—Ñ–∏–ª—å {{ user.username }}</h1>
    
    <!-- –ö—Ä—É–∂–æ–∫ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ -->
    <div class="photo-section">
        <div class="upload-circle" onclick="openUploadModal()">
            {% if profile.photo %}
                <img src="{{ profile.photo.url }}" class="profile-photo">
                <div class="change-overlay">‚úé</div>
            {% else %}
                <div class="plus-icon">+</div>
            {% endif %}
        </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è —Å –∏–Ω–ª–∞–π–Ω-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º -->
    <form method="post" enctype="multipart/form-data" id="profileForm">
        {% csrf_token %}
        
        <div class="profile-info">
            <!-- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <div class="editable-field" data-field="username" onclick="startEditing('username')">
                <strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong>
                <span class="field-value {% if not user.username %}empty-field{% endif %}">
                    {{ user.username|default:"–ù–µ —É–∫–∞–∑–∞–Ω–æ" }}
                </span>
                <div class="edit-icon">‚úé</div>
                <div class="field-actions" id="username-actions">
                    <input type="text" name="username" value="{{ user.username }}" class="edit-input">
                    <button type="button" onclick="saveField('username')" class="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" onclick="cancelEditing('username')" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>

            <!-- –ü–æ–ª -->
            <div class="editable-field" data-field="gender" onclick="startEditing('gender')">
                <strong>–ü–æ–ª:</strong>
                <span class="field-value {% if not profile.gender %}empty-field{% endif %}">
                    {{ profile.get_gender_display|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}
                </span>
                <div class="edit-icon">‚úé</div>
                <div class="field-actions" id="gender-actions">
                    <select name="gender" class="edit-select">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                        <option value="M" {% if profile.gender == 'M' %}selected{% endif %}>–ú—É–∂—Å–∫–æ–π</option>
                        <option value="F" {% if profile.gender == 'F' %}selected{% endif %}>–ñ–µ–Ω—Å–∫–∏–π</option>
                        <option value="O" {% if profile.gender == 'O' %}selected{% endif %}>–î—Ä—É–≥–æ–π</option>
                    </select>
                    <button type="button" onclick="saveField('gender')" class="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" onclick="cancelEditing('gender')" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>

            <!-- –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è -->
            <div class="editable-field" data-field="birth_date" onclick="startEditing('birth_date')">
                <strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong>
                <span class="field-value {% if not profile.birth_date %}empty-field{% endif %}">
                    {{ profile.birth_date|default:"–ù–µ —É–∫–∞–∑–∞–Ω–∞" }}
                </span>
                <div class="edit-icon">‚úé</div>
                <div class="field-actions" id="birth_date-actions">
                    <input type="date" name="birth_date" value="{{ profile.birth_date|date:'Y-m-d' }}" class="edit-input">
                    <button type="button" onclick="saveField('birth_date')" class="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" onclick="cancelEditing('birth_date')" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
            <div class="editable-field" data-field="description" onclick="startEditing('description')">
                <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                <span class="field-value {% if not profile.description %}empty-field{% endif %}">
                    {{ profile.description|default:"–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è" }}
                </span>
                <div class="edit-icon">‚úé</div>
                <div class="field-actions" id="description-actions">
                    <textarea name="description" class="edit-textarea">{{ profile.description }}</textarea>
                    <button type="button" onclick="saveField('description')" class="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" onclick="cancelEditing('description')" class="cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ -->
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ -->
<div id="uploadModal" class="modal">
    <div class="modal-content">
        <a href="#" class="close-btn">√ó</a>
        <h3>–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è</h3>

        <form method="post" enctype="multipart/form-data" id="uploadForm">
            {% csrf_token %}

            <div class="drop-zone" id="dropZone">
                <input type="file" name="photo" id="fileInput" accept="image/*" required>
                <div class="drop-content">
                    <div class="upload-icon">üìÅ</div>
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ —Å—é–¥–∞</p>
                    <p class="or-text">–∏–ª–∏</p>
                    <button type="button" class="browse-btn">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</button>
                </div>
                <div class="file-name" id="fileName"></div>
            </div>
        </form>
    </div>
</div>


<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function openUploadModal() {
        window.location.href = '#uploadModal';
    }
    
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileName = document.getElementById('fileName');
    const uploadForm = document.getElementById('uploadForm');
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function closeModal() {
        window.location.href = '#';
    }
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∞–π–ª–∞
    fileInput.addEventListener('change', function() {
        if (this.files.length) {
            fileName.textContent = this.files[0].name;
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ä–∞–∑—É
            closeModal();
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
            setTimeout(() => {
                uploadForm.submit();
            }, 100);
        }
    });
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ drop
    dropZone.addEventListener('drop', function(e) {
        const files = e.dataTransfer.files;
        if (files.length) {
            fileInput.files = files;
            fileName.textContent = files[0].name;
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ä–∞–∑—É
            closeModal();
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
            setTimeout(() => {
                uploadForm.submit();
            }, 100);
        }
    });
    
    // –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É
    document.querySelector('.browse-btn').addEventListener('click', function() {
        fileInput.click();
    });
    
    // Drag and drop —Å–æ–±—ã—Ç–∏—è
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => {
            dropZone.classList.add('dragover');
        }, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => {
            dropZone.classList.remove('dragover');
        }, false);
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    document.querySelector('.close-btn').addEventListener('click', function(e) {
        e.preventDefault();
        closeModal();
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
            closeModal();
        }
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeModal();
        }
    });
    </script>
    {% endblock %}